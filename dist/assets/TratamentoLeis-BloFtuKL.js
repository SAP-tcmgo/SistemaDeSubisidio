import{r as n,j as e,I as ie,J as Te,K as oe,O as ne,U as Fe,W as le,X as Be,Y as ce,Z as de,$ as Re,a0 as Ve,a1 as me,a2 as ze,a3 as Oe,u as Me,a4 as Y}from"./vendor-others-Di0KkQDI.js";import{S as $e,H as He}from"./Sidebar-BZGUXzy7.js";import{B as Ge,I as qe,C as S}from"./BreadcrumbNav-CSMjTWsb.js";import{L as x}from"./label-jEBYVF-M.js";import{I as w}from"./input-BZ_84MY_.js";import{T as Z}from"./textarea-DZ8cugno.js";import{c as p,b as Je,d as D,t as u}from"./main-Csx-NwpM.js";import{d as xe,e as Ue,f as Qe,a as _,g as V,P as z,h as ee,T as ae}from"./vendor-lucide-DmcWVqu_.js";import{B as d}from"./button-CM4tlvmz.js";import{D as O,a as Ke,b as M,c as $,d as H,e as se,S as G,f as q,g as J}from"./dialog-niOKxZFA.js";import{c as re,e as We,d as te,u as Xe,k as Ye,l as Ze,m as _e}from"./vendor-firebase-DUe4cX6Q.js";import"./vendor-react-query-De-ebuA0.js";const ea=ze,aa=Oe,he=n.forwardRef(({className:l,children:i,...o},r)=>e.jsxs(ie,{ref:r,className:p("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",l),...o,children:[i,e.jsx(Te,{asChild:!0,children:e.jsx(xe,{className:"h-4 w-4 opacity-50"})})]}));he.displayName=ie.displayName;const ue=n.forwardRef(({className:l,...i},o)=>e.jsx(oe,{ref:o,className:p("flex cursor-default items-center justify-center py-1",l),...i,children:e.jsx(Ue,{className:"h-4 w-4"})}));ue.displayName=oe.displayName;const pe=n.forwardRef(({className:l,...i},o)=>e.jsx(ne,{ref:o,className:p("flex cursor-default items-center justify-center py-1",l),...i,children:e.jsx(xe,{className:"h-4 w-4"})}));pe.displayName=ne.displayName;const ge=n.forwardRef(({className:l,children:i,position:o="popper",...r},E)=>e.jsx(Fe,{children:e.jsxs(le,{ref:E,className:p("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",l),position:o,...r,children:[e.jsx(ue,{}),e.jsx(Be,{className:p("p-1",o==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),e.jsx(pe,{})]})}));ge.displayName=le.displayName;const sa=n.forwardRef(({className:l,...i},o)=>e.jsx(ce,{ref:o,className:p("py-1.5 pl-8 pr-2 text-sm font-semibold",l),...i}));sa.displayName=ce.displayName;const m=n.forwardRef(({className:l,children:i,...o},r)=>e.jsxs(de,{ref:r,className:p("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",l),...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Re,{children:e.jsx(Qe,{className:"h-4 w-4"})})}),e.jsx(Ve,{children:i})]}));m.displayName=de.displayName;const ra=n.forwardRef(({className:l,...i},o)=>e.jsx(me,{ref:o,className:p("-mx-1 my-1 h-px bg-muted",l),...i}));ra.displayName=me.displayName;const ja=()=>{const l=Me(),[i,o]=n.useState(!1),{municipio:r,numeroHabitantes:E,setNumeroHabitantes:f,doQueSeTrata:g,setDoQueSeTrata:U,leis:j,setLeis:fe,leisColare:ta,setLeisColare:ia,numeroProcesso:Q}=Je(),[N,C]=n.useState([]),[I,K]=n.useState(!1),[L,k]=n.useState(null),[je,b]=n.useState(!1),[c,v]=n.useState({}),[P,T]=n.useState(!1),[Ne,F]=n.useState(!1),[be,ve]=n.useState(!1);n.useEffect(()=>{(async()=>{if(r&&r.codigo)try{const t=(await Y.get(`https://apisidra.ibge.gov.br/values/t/4714/n6/${r.codigo}/v/93/p/2022`)).data[1],h=(t==null?void 0:t.V)||"0";f(parseInt(h,10))}catch(s){console.error("Erro ao buscar população:",s),Y.isAxiosError(s)&&s.response&&console.error("Erro ao buscar população (detalhes):",s.response.data),f(0)}else f(0)})()},[r==null?void 0:r.codigo,f,r]);const B=async()=>{if(!(r!=null&&r.codigo)){C([]);return}K(!0),k(null);try{const a=re(D,"LeisPolicitaInflacionarias"),t=(await We(a)).docs.map(h=>({id:h.id,...h.data()})).filter(h=>h.municipioCodigo===r.codigo);C(t)}catch(a){console.error("Erro ao buscar leis inflacionárias:",a),k("Falha ao buscar leis inflacionárias."),C([])}finally{K(!1)}};n.useEffect(()=>{B()},[r==null?void 0:r.codigo]);const y=a=>{const{name:s,value:t}=a.target;v(h=>({...h,[s]:t}))},ye=(a,s)=>{v(t=>({...t,[a]:s}))},we=()=>{T(!1),v({}),b(!0)},W=a=>{T(!0),v(a),b(!0)},Ce=async()=>{if(!r){u({title:"Erro",description:"Município não selecionado.",variant:"destructive"});return}if(!c.numeroLeiAno||!c.teorArtigo){u({title:"Erro",description:"Preencha os campos obrigatórios (Número da Lei/Ano, Teor do Artigo).",variant:"destructive"});return}const a={municipioNome:r.nome,municipioCodigo:r.codigo,numeroLeiAno:c.numeroLeiAno||"",artigosIncisosParagrafos:c.artigosIncisosParagrafos||"",teorArtigo:c.teorArtigo||"",indice:c.indice||"",mesDataBase:c.mesDataBase||"",entradaEmVigor:c.entradaEmVigor||""};try{const s=re(D,"LeisPoliticaInflacionarias");if(P&&c.id){const t=te(D,"LeisPoliticaInflacionarias",c.id);await Xe(t,a),u({title:"Sucesso",description:"Lei atualizada com sucesso!"})}else await Ye(s,{...a,criadoEm:Ze()}),u({title:"Sucesso",description:"Nova lei cadastrada com sucesso!"});b(!1),B()}catch(s){console.error("Erro ao salvar lei:",s);const t=s instanceof Error?s.message:"Erro desconhecido";u({title:"Erro",description:`Falha ao salvar lei: ${t}`,variant:"destructive"})}},X=async a=>{if(window.confirm("Tem certeza que deseja excluir esta lei?"))try{const s=te(D,"LeisPoliticaInflacionarias",a);await _e(s),u({title:"Sucesso",description:"Lei excluída com sucesso!"}),B()}catch(s){console.error("Erro ao excluir lei:",s);const t=s instanceof Error?s.message:"Erro desconhecido";u({title:"Erro",description:`Falha ao excluir lei: ${t}`,variant:"destructive"})}},R=a=>{a&&fe(s=>s.includes(a)?s.filter(t=>t!==a):[...s,a])},Le=(a,s)=>{s.stopPropagation(),W(a),F(!1)},Ae=()=>{o(!i)},A=a=>{const s=g.includes(a)?g.filter(t=>t!==a):[...g,a];U(s)},Se=a=>{const s=parseInt(a.target.value.replace(/\D/g,""),10);f(isNaN(s)?0:s)},De=a=>typeof a!="number"||isNaN(a)?"0":a.toLocaleString("pt-BR"),Ee=()=>{U([]),C([]),k(null),b(!1),v({}),T(!1),u({title:"Tela Limpa",description:"Campos da tela redefinidos."})},Ie=()=>{Ee()},ke=()=>{l("/MunicipioEResponsaveis")},Pe=()=>{l("/Fixacao")};return e.jsx("div",{className:"municipios-theme flex min-h-screen flex-col bg-gray-50",children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx($e,{isOpen:i,setIsOpen:o}),e.jsxs("div",{className:`transition-all duration-300 ${i?"ml-64":"ml-0"}`,children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx(He,{toggleSidebar:Ae})}),e.jsx(Ge,{currentPage:"Tratamento Leis",sidebarOpen:i}),e.jsx("main",{className:"min-h-screen bg-pattern bg-gray-100 py-8 px-4 ",children:e.jsx("div",{className:"max-w-5xl mx-auto bg-white rounded-lg shadow-md overflow-hidden ",children:e.jsxs("div",{className:"p-6 ",children:[e.jsx("div",{className:"mt-[-20px] flex justify-end",children:e.jsx(qe,{onEraseClick:Ie,onBackClick:ke,onNextClick:Pe})}),e.jsx("div",{className:"relative mb-8 text-primary text-center",children:e.jsxs("h1",{className:"text-2xl font-bold mt-[-20px]",children:["Trata-se de ",Q&&`(${Q})`]})}),e.jsxs("div",{className:"text-gray-700 flex flex-wrap gap-6 mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"fixacaoCheckbox",checked:g.includes("fixacao"),onCheckedChange:()=>A("fixacao")}),e.jsx(x,{htmlFor:"fixacaoCheckbox",className:"text-sm",children:"Fixação"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"revisaoGeralCheckbox",checked:g.includes("revisaoGeral"),onCheckedChange:()=>A("revisaoGeral")}),e.jsx(x,{htmlFor:"revisaoGeralCheckbox",className:"text-sm",children:"Revisão Geral Anual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"decimoTerceiroCheckbox",checked:g.includes("decimoTerceiro"),onCheckedChange:()=>A("decimoTerceiro")}),e.jsx(x,{htmlFor:"decimoTerceiroCheckbox",className:"text-sm",children:"Décimo Terceiro"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"feriasCheckbox",checked:g.includes("ferias"),onCheckedChange:()=>A("ferias")}),e.jsx(x,{htmlFor:"feriasCheckbox",className:"text-sm",children:"Férias"})]})]}),e.jsxs("div",{className:"text-gray-700 mb-8",children:[e.jsxs("h2",{className:"mb-2 font-medium text-sm",children:["Número de Habitantes no município de ",(r==null?void 0:r.nome)||"..."]}),e.jsx(w,{type:"text",value:De(E),onChange:Se,className:"border-2 border-gray-300 h-12 w-32",placeholder:"0"})]}),e.jsxs("div",{className:"text-gray-700 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h2",{className:"font-medium text-sm",children:["Leis acerca da política inflacionária do município ",(r==null?void 0:r.nome)||"...",":"]}),e.jsxs("div",{className:"flex space-x-2",children:[" ",e.jsxs(O,{open:be,onOpenChange:ve,children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(d,{variant:"outline",size:"sm",className:"text-primary border-primary hover:bg-primary/10",children:[e.jsx(_,{className:"h-4 w-4 mt-[3px]"}),"Visualizar Leis Incluídas (",j.length,") "]})}),e.jsxs(M,{className:"sm:max-w-[700px] bg-white max-h-[80vh] flex flex-col",children:[e.jsxs($,{children:[e.jsx(H,{className:"text-lg font-semibold text-gray-800 text-center font-bold",children:"Leis Incluídas no Processo"}),e.jsx(se,{className:"text-center",children:"Leis selecionadas para este processo."})]}),e.jsxs("div",{className:"py-4 overflow-y-auto flex-grow border border-gray-300 rounded-md p-4",children:[" ",I?e.jsx("p",{className:"text-center text-gray-500",children:"Carregando..."}):j.length>0?e.jsx(G,{className:"h-[400px] w-full",children:N.filter(a=>a.id&&j.includes(a.id)).map(a=>e.jsxs("div",{className:"border border-gray-300 p-2 rounded mb-2 flex justify-between items-center text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.numeroLeiAno}),e.jsxs("p",{className:"text-gray-600 truncate",children:[a.teorArtigo.substring(0,80),a.teorArtigo.length>80?"...":""]})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>a.id&&R(a.id),className:"text-red-500 hover:text-red-700",title:"Remover do Processo",children:e.jsx(V,{className:"h-4 w-4"})})]},a.id))}):e.jsx("p",{className:"text-center text-gray-500",children:"Nenhuma lei incluída neste processo ainda."})]}),e.jsx(q,{className:"mt-auto pt-4 border-t border-gray-200",children:e.jsx(J,{asChild:!0,children:e.jsx(d,{type:"button",variant:"outline",children:"Fechar"})})})]})]}),e.jsxs(d,{onClick:we,size:"sm",className:"bg-secondary hover:bg-secondary/90 text-white",children:[e.jsx(z,{className:"h-4 w-4 mt-[3px]"}),"Cadastrar Lei"]}),e.jsx(O,{open:Ne,onOpenChange:F,children:e.jsxs(M,{className:"sm:max-w-[900px] bg-white max-h-[80vh] flex flex-col",children:[e.jsxs($,{children:[e.jsxs(H,{className:"text-lg font-semibold text-gray-800 text-center font-bold",children:["Todas Leis Cadastradas - ",(r==null?void 0:r.nome)||"Município"]}),e.jsx(se,{className:"text-center",children:"Lista de todas as leis cadastradas para este município."})]}),e.jsx("div",{className:"py-4 overflow-y-auto flex-grow border border-gray-300 rounded-md p-4",children:I?e.jsx("p",{className:"text-center text-gray-500",children:"Carregando leis..."}):L?e.jsx("p",{className:"text-center text-red-500",children:L}):N.length>0?e.jsxs(G,{className:"h-[450px] w-full",children:[" ",N.map(a=>{const s=a.id?j.includes(a.id):!1;return e.jsxs("div",{className:`border border-gray-300 rounded-md p-3 mb-2 flex justify-between items-center text-sm ${s?"bg-green-100":""}`,children:[e.jsxs("div",{className:"flex-1 mr-4 overflow-hidden",children:[e.jsx("p",{className:"font-medium truncate",children:a.numeroLeiAno}),e.jsx("p",{className:"text-gray-600 truncate",children:a.teorArtigo})]}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx(d,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:t=>Le(a,t),title:"Editar Lei",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-7 w-7 text-red-500 hover:text-red-700",onClick:t=>{t.stopPropagation(),a.id&&X(a.id)},title:"Excluir Lei",disabled:!a.id,children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",className:`h-7 w-7 ${s?"text-red-500 hover:text-red-700":"text-primary hover:text-primary/80"}`,onClick:t=>{t.stopPropagation(),a.id&&R(a.id)},title:s?"Remover do Processo":"Incluir no Processo",disabled:!a.id,children:s?e.jsx(V,{className:"h-4 w-4"}):e.jsx(z,{className:"h-4 w-4"})})]})]},a.id||a.numeroLeiAno)})]}):e.jsx("p",{className:"text-center text-gray-500",children:"Nenhuma lei inflacionária cadastrada para este município."})}),e.jsx(q,{className:"mt-auto pt-4 border-t border-gray-200",children:e.jsx(J,{asChild:!0,children:e.jsx(d,{type:"button",variant:"outline",children:"Fechar"})})})]})})]})]}),e.jsxs("div",{className:"border border-gray-300 rounded-md text-sm min-h-[100px] p-4",children:[" ",I?e.jsx("div",{className:"text-gray-500 italic",children:"Carregando leis..."}):L?e.jsx("div",{className:"text-red-600 italic",children:L}):N.length>0?e.jsxs(G,{className:"h-[200px] w-full",children:[" ",N.map(a=>{const s=a.id?j.includes(a.id):!1;return e.jsxs("div",{className:`border border-gray-300 rounded-md p-3 mb-2 flex justify-between items-center ${s?"bg-green-100":""}`,children:[e.jsxs("span",{className:"flex-1 pr-4 overflow-hidden",children:[e.jsx("p",{className:"font-medium truncate",children:a.numeroLeiAno}),e.jsxs("p",{className:"text-gray-600 truncate",children:[a.teorArtigo.substring(0,80),a.teorArtigo.length>80?"...":""]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>W(a),title:"Editar Lei",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-7 w-7 text-red-500 hover:text-red-700",onClick:()=>a.id&&X(a.id),title:"Excluir Lei",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",className:`h-7 w-7 ${s?"text-red-500 hover:text-red-700":"text-primary hover:text-primary/80"}`,onClick:()=>a.id&&R(a.id),title:s?"Remover do Processo":"Incluir no Processo",disabled:!a.id,children:s?e.jsx(V,{className:"h-4 w-4"}):e.jsx(z,{className:"h-4 w-4"})})]})]},a.id||a.numeroLeiAno)})]}):e.jsx("div",{className:"text-gray-500 italic",children:"Nenhuma lei inflacionária cadastrada para este município."})]})]}),e.jsx(O,{open:je,onOpenChange:b,children:e.jsxs(M,{className:"sm:max-w-[800px] bg-white dialog-content-min-height",children:[e.jsx($,{children:e.jsx(H,{className:"text-lg font-semibold text-gray-800 text-center font-bold mb-[-15px]",children:P?"Editar Lei da Política Inflacionária":"Cadastrar Nova Lei"})}),e.jsxs("div",{className:"py-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"municipioNome",children:"Município"}),e.jsx(w,{id:"municipioNome",value:(r==null?void 0:r.nome)||"N/A",disabled:!0,className:"mt-1 bg-gray-100"})]}),e.jsxs("div",{children:[e.jsxs(x,{htmlFor:"numeroLeiAno",children:["Número da Lei/Ano ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(w,{id:"numeroLeiAno",name:"numeroLeiAno",value:c.numeroLeiAno||"",onChange:y,className:"mt-1",placeholder:"Ex: 1234/24"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{htmlFor:"artigosIncisosParagrafos",children:"Artigos, Incisos e Parágrafos"}),e.jsx(Z,{id:"artigosIncisosParagrafos",name:"artigosIncisosParagrafos",value:c.artigosIncisosParagrafos||"",onChange:y,className:"mt-1",placeholder:"Iniciar com o nº do artigo..."})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsxs(x,{htmlFor:"teorArtigo",children:["Teor do artigo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Z,{id:"teorArtigo",name:"teorArtigo",value:c.teorArtigo||"",onChange:y,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"indice",children:"Índice"}),e.jsx(w,{id:"indice",name:"indice",value:c.indice||"",onChange:y,className:"mt-1",placeholder:"Ex: INPC"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"mesDataBaseTrigger",children:"Mês da Data Base Municipal"}),e.jsxs(ea,{name:"mesDataBase",value:c.mesDataBase||"",onValueChange:a=>ye("mesDataBase",a),children:[e.jsx(he,{id:"mesDataBaseTrigger",className:"mt-1",children:e.jsx(aa,{placeholder:"Selecione o mês"})}),e.jsxs(ge,{className:"bg-white",children:[e.jsx(m,{value:"janeiro",children:"Janeiro"}),e.jsx(m,{value:"fevereiro",children:"Fevereiro"}),e.jsx(m,{value:"marco",children:"Março"}),e.jsx(m,{value:"abril",children:"Abril"}),e.jsx(m,{value:"maio",children:"Maio"}),e.jsx(m,{value:"junho",children:"Junho"}),e.jsx(m,{value:"julho",children:"Julho"}),e.jsx(m,{value:"agosto",children:"Agosto"}),e.jsx(m,{value:"setembro",children:"Setembro"}),e.jsx(m,{value:"outubro",children:"Outubro"}),e.jsx(m,{value:"novembro",children:"Novembro"}),e.jsx(m,{value:"dezembro",children:"Dezembro"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"entradaEmVigor",children:"Entrada em vigor da Lei"}),e.jsx(w,{id:"entradaEmVigor",name:"entradaEmVigor",type:"date",value:c.entradaEmVigor||"",onChange:y,className:"mt-1",placeholder:"DD/MM/AAAA"})]})]}),e.jsxs(q,{style:{backgroundColor:"white",borderTop:"1px solid #ccc",padding:"10px"},children:[e.jsx("div",{className:"flex justify-start w-full",children:e.jsxs(d,{type:"button",variant:"outline",onClick:()=>F(!0),className:"text-primary border-primary hover:bg-primary/10",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Visualizar Todas Cadastradas"]})}),e.jsx(J,{asChild:!0,children:e.jsx(d,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(d,{type:"button",onClick:Ce,className:"bg-primary hover:bg-primary/90 text-white ml-2",style:{backgroundColor:"#004B8D",color:"white"},children:P?"Salvar Alterações":"Cadastrar Lei"})]})]})})]})})})]})]})})};export{ja as default};
